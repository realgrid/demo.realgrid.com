<html>
<head>
	<title>RealGridJS sample page</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script src="/lib/realgrid/realgridjs-lic.js"></script>
	<script src="/lib/realgrid/realgridjs_eval.wa/realgridjs_eval.1.1.26.min.js"></script>
	<script src="/lib/realgrid/realgridjs_eval.wa/realgridjs-api.1.1.26.js"></script>
	<script src="/lib/jquery/jquery-1.11.2.min.js"></script>
	<script language="javascript">
	var dataProvider;
	var gridView;
	var firstFocus = true;
	$(document).ready( function() {
	    RealGridJS.setTrace(false);
	    RealGridJS.setRootContext("/lib/realgrid/realgridjs_eval.1.1.22/");
	    
	    dataProvider = new RealGridJS.LocalDataProvider();
	    dataProvider.setOptions({
	        datetimeFormat: "yyyy-MM-dd a hh:mm:ss",
	        amText: "오전",
	        pmText: "오후"
	    });

	    dataProvider.setFields([
	    	{
	    		"fieldName": "ImageButton"
	    	},
	    	{
	    		"fieldName": "ImageButtons"
	    	},
		    {
		        "fieldName": "OrderID"
		    },
		    {
		        "fieldName": "CustomerID"
		    },
		    {
		        "fieldName": "EmployeeID"
		    },
		    {
		        "fieldName": "OrderDate",
		        "dataType": "datetime"
		    },
		    {
		    	"fieldName": "CustomerID2"
		    },
		    {
		        "fieldName": "CompanyName"
		    },
		    {
		        "fieldName": "Country"
		    },
		    {
		        "fieldName": "Quantity",
		        "dataType": "number"
		    },
		    {
		    	"fieldName": "ShipCountry"
		    }
		]);
	    gridView = new RealGridJS.GridView("realgrid", true);
	    gridView.setDataSource(dataProvider);   
	    gridView.setColumns([
			{
				"name": "ImageButton",
				"fieldName": "ImageButton",
				"width": 50,
				"renderer": {
					"type": "imageButton",
					"text": "",
					"name": "팝업",
					"imageUrl": "/resource/image/btnImages/popup_normal.png",
					"hoverUrl": "/resource/image/btnImages/popup_hover.png",
					"activeUrl": "/resource/image/btnImages/popup_click.png",
				},
				"editable": false,
				"readOnly": true,
				"styles": {
					"textAlignment": "near"
				},
				"header": {
					"text": "팝업"
				}
			},
		    {
		        "name": "ImageButtons",
		        "fieldName": "ImageButtons",
		        "width": 50,
		        "buttonVisibility": "always",
		        "button": "image",
		        "imageButtons": {
		            "width": 45,
		            "height": 13,
		            "images": [
		                {
		                    "name": "조회",
		                    "up": "/resource/image/btnImages/search_normal.png",
		                    "hover": "/resource/image/btnImages/search_hover.png",
		                    "down": "/resource/image/btnImages/search_click.png"
		                }
		            ]
		        },
		        "editable": false,
		        "readOnly": true,
		        "header": {
		            "text": "직원"
		        }
		    },
		    {
		        "name": "EmployeeID2",
		        "fieldName": "EmployeeID",
		        "width": "150",
		        "button": "action",
		        "styles": {
		            "textAlignment": "center"
		        },
		        "editable": false,
		        "header": {
		            "text": "직원 번호"
		        }
		    },
		    {
		        "name": "OrderID",
		        "fieldName": "OrderID",
		        "editor": {
		            "maxLength": 5
		        },
		        "width": "90",
		        "styles": {
		            "textAlignment": "center"
		        },
		        "textInputCase": "upper",
		        "header": {
		            "text": "아이디"
		        }
		    },
		    {
		        "name": "CompanyName",
		        "fieldName": "CompanyName",
		        "width": "200",
		        "editor": {
		            "type": "multiline",
		            "textCase": "upper"
		        },
		        "styles": {
		            "textAlignment": "near",
		            "textWrap": "normal"
		        },
		        "header": {
		            "text": "메모"
		        }
		    },
		    {
		        "name": "Quantity",
		        "fieldName": "Quantity",
		        "width": "100",
		        "sortable": false,
		        "editor": {
		            "type": "number",
		            "textAlignment": "far",
		            "editFormat": "#,##0.##",
		            "multipleChar": "+"
		        },
		        "styles": {
		            "textAlignment": "far",
		            "numberFormat": "#,##0.##"
		        },
		        "header": {
		            "text": "금액"
		        }
		    },
		    {
		        "name": "CustomerNames",
		        "fieldName": "CustomerID2",
		        "width": "150",
		        "sortable": false,
		        "lookupDisplay": true,
		        "values": [
		            "VINET",
		            "HANAR",
		            "SUPRD",
		            "VICTE",
		            "THREE",
		            "SEVEN"
		        ],
		        "labels": [
		            "<VINET>",
		            "<HANAR>",
		            "<SUPRD>",
		            "<VICTE>",
		            "<THREE>",
		            "<SEVEN>"
		        ],
		        "editor": {
		            "type": "dropDown",
		            "dropDownCount": 4
		        },
		        "styles": {
		            "textAlignment": "center"
		        },
		        "header": {
		            "text": "국가1"
		        }
		    },
		    {
		        "name": "CustomerNames2",
		        "fieldName": "CustomerID2",
		        "width": "150",
		        "sortable": false,
		        "editor": {
		            "type": "dropDown",
		            "dropDownCount": 4,
		            "domainOnly": true,
		            "textReadOnly": true,
		            "values": [
		                "VINET",
		                "HANAR",
		                "SUPRD",
		                "VICTE",
		                "THREE",
		                "SEVEN"
		            ],
		            "labels": [
		                "<VINET>",
		                "<HANAR>",
		                "<SUPRD>",
		                "<VICTE>",
		                "<THREE>",
		                "<SEVEN>"
		            ]
		        },
		        "styles": {
		            "textAlignment": "center"
		        },
		        "header": {
		            "text": "국가2"
		        }
		    },
		    {
		        "name": "Country",
		        "fieldName": "Country",
		        "width": "100",
		        "styles": {
		            "textAlignment": "center"
		        },
		        "values": [
		            "Argentina",
		            "Austria",
		            "Belgium",
		            "Brazil",
		            "Canada",
		            "Denmark",
		            "Finland",
		            "France",
		            "Germany",
		            "Ireland",
		            "Italy",
		            "Mexico",
		            "Norway",
		            "Poland",
		            "Portugal",
		            "Spain",
		            "Sweden",
		            "Switzerland",
		            "UK",
		            "USA",
		            "Venezuela"
		        ],
		        "editor": {
		            "type": "dropDown"
		        },
		        "header": {
		            "text": "국가명"
		        }
		    },
		    {
		        "name": "CustomerID2",
		        "fieldName": "CustomerID",
		        "type": "data",
		        "width": "150",
		        "lookupSourceId": "customers",
		        "lookupKeyFields": [
		            "Country",
		            "CustomerID"
		        ],
		        "editor": {
		            "type": "dropDown"
		        },
		        "styles": {
		            "textAlignment": "center"
		        },
		        "header": {
		            "text": "고객 ID"
		        }
		    },
		    {
		        "name": "CustomerID3",
		        "fieldName": "CustomerID",
		        "type": "data",
		        "width": "200",
		        "lookupDisplay": "true",
		        "lookupSourceId": "customers",
		        "lookupKeyFields": [
		            "Country",
		            "CustomerID"
		        ],
		        "styles": {
		            "textAlignment": "center"
		        },
		        "header": {
		            "text": "회사명"
		        }
		    },
		    {
		        "name": "OrderDate",
		        "fieldName": "OrderDate",
		        "width": "180",
		        "sortable": false,
		        "editor": {
		            "type": "date",
		            "datetimeFormat": "yyyy.MM.dd"
		        },
		        "styles": {
		            "textAlignment": "center",
		            "datetimeFormat": "yyyy.MM.dd"
		        },
		        "header": {
		            "text": "날짜"
		        }
		    },
		    {
		        "name": "ShipCountry",
		        "fieldName": "ShipCountry",
		        "width": "100",
		        "styles": {
		            "textAlignment": "center"
		        },
		        "header": {
		            "text": "상세보기"
		        }
		    }
		]);
		
		loadData(dataProvider);
/*
		var data = ["팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회","팝업","조회"]

	    for(var i = 0; i < data.length; i++){
	      dataProvider.setValue(i,"ImageButton",data[i])
	    }
*/
		gridView.setDisplayOptions({rowHeight:30});
		gridView.setColumnProperty("EmployeeID", "buttonVisibility", "always");
		gridView.setColumnProperty("EmployeeID2", "buttonVisibility", "always");
		gridView.setColumnProperty("ShipCountry", "renderer", {
		    type: "link",
		    url: "http://www.countryreports.org/country/${ShipCountry}.htm",
		    requiredFields: "ShipCountry",
		    showUrl: true
		});
		gridView.onCellButtonClicked = function (grid, itemIndex, column) {
          alert("CellButton Clicked: itemIndex=" + itemIndex + ", fieldName=" + column.fieldName);
	    };

	    gridView.onImageButtonClicked = function (grid, itemIndex, column, buttonIndex, name) {
	    	if(buttonIndex == undefined){
	    		alert("onImageButtonClicked: " + itemIndex + ", " + column.name);
	    	}else{
	          alert("onImageButtonClicked: " + itemIndex + ", " + column.name+", " + buttonIndex + ", " + name);
	    	}
	    };
		gridView.onLinkableCellClicked = function (grid, index, url) {
		    window.open(url, '_newtab');
		};

		var CustomerNames = ["ALFKI", "ANATR", "ANTON", "AROUT", "BERGS", "BLAUS", "BLONP", "BOLID", "BONAP", "BOTTM", "BSBEV", "CACTU", "CENTC", "CHOPS", "COMMI", "CONSH", "DRACD", "DUMON", "EASTC", "ERNSH", "FAMIA", "FISSA", "FOLIG", "FOLKO", "FRANK", "FRANR", "FRANS", "FURIB", "GALED", "GODOS", "GOURL", "GREAL", "GROSR", "HANAR", "HILAA", "HUNGC", "HUNGO", "ISLAT", "KOENE", "LACOR", "LAMAI", "LAUGB", "LAZYK", "LEHMS", "LETSS", "LILAS", "LINOD", "LONEP", "MAGAA", "MAISD", "MEREP", "MORGK", "NORTS", "OCEAN", "OLDWO", "OTTIK", "PARIS", "PERIC", "PICCO", "PRINI", "QUEDE", "QUEEN", "QUICK", "RANCH", "RATTC", "REGGC", "RICAR", "RICSU", "ROMEY", "SANTG", "SAVEA", "SEVES", "SIMOB", "SPECD", "SPLIR", "SUPRD", "THEBI", "THECR", "TOMSP", "TORTU", "TRADH", "TRAIH", "VAFFE", "VICTE", "VINET", "WANDK", "WARTH", "WELLI", "WHITC", "WILMK", "WOLZA"];

		gridView.onEditSearch = function (grid, index, text) {
		    console.log("onEditSearch:" + index.itemIndex + "," + index.column + ", " + text);
		    var items = CustomerNames.filter(function (str) {
		        return str.indexOf(text) == 0;
		    });
		    console.log(items);
		    grid.fillEditSearchItems(index.column, text, items);
		};

		gridView.setEditOptions({buttonClickWhenSpace:true});

		//lookupTree
		var source = {
		    "id": "customers",
		    "levels": 2,
		    "keys": [
		      ["France", "VINET"],
		      ["France", "VICTE"],
		      ["Germany", "TOMSP"],
		      ["Brazil", "HANAR"]
		    ],
		    "values": [
		      "Vins et alcools Chevalier",
		      "Victuailles en stock",
		      "Toms Spezialitäten",
		      "Hanari Carnes"
		    ]
		  };

		  gridView.addLookupSource(source);

		  gridView.onEditCommit = function (id, index, oldValue, newValue) {
		    if (index.field == "Country") {
		      lookupDataChange(newValue);
		    }
		  };

		  gridView.onCurrentChanged = function (grid, newIndex) {
		    if (newIndex && newIndex.dataRow > -1) {
		      var keyValue = grid.getValue(newIndex.itemIndex, "Country");
		      lookupDataChange(keyValue);
		    }
		  };

		  var oldKey = null;
		  function lookupDataChange(keyValue) {
		    if (oldKey != keyValue) {
		      var params = { country: keyValue };

		      $.getJSON("/resource/data/AllCustomerByCountry.json", function (data) {
		        lookupData = [];
		        for(var j = 0; j < data.length; j++){
		          if (data[j].Country == params.country){
		            lookupData.push(data[j])
		          }
		        } 
		        var lookups = [];
		        for (var i in lookupData) {
		          if (!gridView.existsLookupData("customers", [lookupData[i].Country, lookupData[i].CustomerID])) {
		            var lookup = [lookupData[i].Country, lookupData[i].CustomerID, lookupData[i].CompanyName];
		            lookups.push(lookup);
		          }
		        }

		        gridView.fillLookupData("customers", {
		          rows: lookups
		        });
		      });

		      oldKey = keyValue;
		    }
		  }

		  gridView.setEditOptions({checkWhenSpace:true,exitGridWhenTab:"row"});
	});

	function loadData(provider) {
	    $.getJSON("/resource/data/DefaultDataSet.json", function (data) {
	        provider.setRows(data);
	    })
	    .done(function () {
	        gridView.setFocus();
	    })
	    .fail(function (jqxhr, textStatus, error) {
	        var err = textStatus + ', ' + error;
	        console && console.log("jQuery getJSON() Failed: " + err);
	        alert("jQuery getJSON() Failed: " + err);
	    });
	}

	function mainGrid() {
		gridView.setDisplayOptions({rowHeight:30});

		var layout = [
			"EmployeeID","EmployeeID2","OrderID","CompanyName","Quantity","CustomerNames","CustomerNames2","CustomerNames3","Country","CustomerID2","CustomerID3","OrderDate","ShipCountry"
		];
		gridView.setColumnLayout(layout);

		gridView.groupBy([]);
	};

	function columnGroup() {
		gridView.setDisplayOptions({rowHeight:80});
		gridView.setColumnLayout([
			{
				name: "button",
				header: {
					text:"직원"
				},
				orientation: "horizontal",
				width:250,
				columns:["EmployeeID","EmployeeID2"]
			},
			"OrderID","CompanyName","Quantity",
			{
				name:"dropdown",
				header:{
					text:"국가 선택"
				},
				orientation: "vertical",
				width:200,
				columns:["CustomerNames","CustomerNames2","CustomerNames3"]
			},{
				name:"lookupTree",
				header:{
					text:"상세정보"
				},
				orientation: "vertical",
				width:200,
				columns:["Country","CustomerID2","CustomerID3"]
			},"OrderDate","ShipCountry"
		]);
	};

	function rowGrouping(){
		gridView.setDisplayOptions({rowHeight:30});
		var layout = [
			"EmployeeID","EmployeeID2","OrderID","CompanyName","CustomerNames2","CustomerNames3","Quantity","CustomerNames","Country","CustomerID2","CustomerID3","OrderDate","ShipCountry"
		];
		gridView.setColumnLayout(layout);

		gridView.groupBy(["OrderID","CompanyName"]);
	};

	function selectChange(){
		if($("#selBox option:selected").val() == "none"){
			gridView.setEditOptions({exitGridWhenTab:"none"});
		}else if($("#selBox option:selected").val() == "row"){
			gridView.setEditOptions({exitGridWhenTab:"row"});
		}else if($("#selBox option:selected").val() == "grid"){
			gridView.setEditOptions({exitGridWhenTab:"grid"});
		}
	}
	</script>
</head>
<body>

	<div id="actions" style="margin-bottom:4px">
        <span id="loadResult" style="display:none"></span>
        <a href="../FunctionCombination/index.html">Home</a>
        <input id="txtMain" style="width: 100px;"/>
        <input id="txtSub" style="width: 80px;display: none"/>
        <input id="txtMin" style="width: 60px;display: none"/>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        그리드 배치 설정 &nbsp;&nbsp;&nbsp;
        <input type="button" id="btnMainGrid" onclick="mainGrid()" value="일반 그리드"/>&nbsp;&nbsp;&nbsp;
        <input type="button" id="btnColumnGroup" onclick="columnGroup()" value="컬럼 그룹"/>&nbsp;&nbsp;&nbsp;
        <input type="button" id="btnRowGroup" onclick="rowGrouping()" value="행 그룹"/>
  	</div>

	<div id="realgrid" style="height:383px;width:950px;" title="리얼그리드"></div>

	<input type="checkbox" name="chk_space" value="check"> SPACE 입력 시 체크박스에 체크가 됩니다.(첫 번째 컬럼에서 왼쪽방향키 입력 후 SPACE로 체크가 가능합니다.)<br/>
	<select name="selBox" id="selBox" onChange="selectChange()">
		<option vlaue="row">row</option>
		<option value="grid">grid</option>
		<option value="none">none</option>
	</select>
	그리드에서 탭키로 이동할 동작을 설정합니다.<br/>
	none: 그리드 외부로 포커스 이동이 불가능 합니다.<br/>
	row: 행과 상관없이 첫번째 컬럼과 마지막 컬럼에서 tab 또는 Shift + tab으로 포커스 이동이 가능합니다.<br/>
	grid: 그리드의 처음(첫 행의 첫 번째컬럼)과 끝(마지막 행의 마지막 컬럼)에서만 tab 또는 Shift + tab으로 포커스 이동이 가능합니다.
</body>
</html>

<!--
센차
http://examples.sencha.com/extjs/6.0.1/examples/
<div id="docs-aria-speakable" class="docs-a11y-ariascreenreader-speakable docs-offscreen" aria-live="assertive" role="region" aria-atomic="true" aria-hidden="false" aria-relevant="additions">11/25/2014;  D167 </div>
<div class="cell-input" tabindex="0" role="textbox" contenteditable="true" dir="ltr" aria-activedescendant="fake-activedescendant-:47" aria-owns="fake-activedescendant-:47">11/25/2014<br></div>
-->


